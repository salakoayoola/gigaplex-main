"use strict";(self.webpackChunkcalendar=self.webpackChunkcalendar||[]).push([["src_services_talkService_js-src_utils_calendarObject_js-src_utils_color_js-src_utils_date_js--af18c6"],{58196:(e,t,a)=>{a.d(t,{Ay:()=>i,Wj:()=>r});var n=a(88075);const r=e=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({},{attendeeProperty:null,commonName:null,calendarUserType:"INDIVIDUAL",participationStatus:"NEEDS-ACTION",role:"REQ-PARTICIPANT",rsvp:!1,uri:null,member:null},e)}({attendeeProperty:e,commonName:e.commonName,calendarUserType:e.userType,participationStatus:e.participationStatus,role:e.role,rsvp:e.rsvp,uri:e.email,member:e.member}),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=n.Uy.fromNameAndEMail(e.displayname,e.emailAddress,t);return a.userType=e.calendarUserType,r(a)}},35442:(e,t,a)=>{a.d(t,{DL:()=>u,NU:()=>y,P$:()=>n,RW:()=>m,W5:()=>r,_l:()=>o,an:()=>l,bd:()=>d,fM:()=>c,mI:()=>s,rk:()=>p,vC:()=>i});const n="VEVENT",r="VJOURNAL",i="VTODO",s="principal:principals/users/",o="principal:principals/groups/",c="principal:principals/circles/",l="principal:principals/calendar-resources/",d="principal:principals/calendar-rooms/",u="contact_birthdays",p="default",m="importing",y="processing"},28928:(e,t,a)=>{a.d(t,{BK:()=>p,Db:()=>l,JW:()=>u,Ky:()=>g,Ze:()=>C,a9:()=>b,dZ:()=>f,hC:()=>y,jb:()=>m,vV:()=>h,wo:()=>w,xX:()=>v});var n=a(32273),r=a(63814),i=a(21777),s=a(35442);const o={},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=(e=>JSON.stringify(e))(e);return o[t]||(o[t]=new n.Ay({rootUrl:(0,r.dC)("dav")},(()=>{const t={"X-Requested-With":"XMLHttpRequest",requesttoken:(0,i.do)(),"X-NC-CalDAV-Webcal-Caching":"On",...e},a=new XMLHttpRequest,n=a.open;return a.open=function(){const e=n.apply(this,arguments);for(const e in t)a.setRequestHeader(e,t[e]);return e},OC.registerXHRForErrorProcessing(a),a}))),o[t]},l=async()=>{await c().connect({enableCalDAV:!0})},d=e=>c(e).calendarHomes[0],u=()=>d().findAllCalDAVCollectionsGrouped(),p=()=>d().findAllDeletedCalendars(),m=async e=>{const t=[];for(const a of e){const e=c().publicCalendarHome.find(a).catch((()=>null));t.push(e)}return(await Promise.all(t)).filter((e=>null!==e))},y=async()=>(await d().findAllScheduleOutboxes())[0],f=async(e,t,a,n,r)=>d().createCalendarCollection(e,t,a,n,r),g=async(e,t,a,n)=>d().createSubscribedCollection(e,t,a,n),h=async()=>(await d().enableBirthdayCalendar(),A()),A=async()=>d().find(s.DL),v=()=>c().currentUserPrincipal,C=async e=>c().principalPropertySearchByDisplaynameOrEmail(e),b=async e=>c().findPrincipal(e),w=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c().findPrincipalsInCollection(e,t)}},81895:(e,t,a)=>{a.d(t,{EX:()=>l});var n=a(65043),r=(a(53334),a(63814)),i=a(32981),s=a(21777),o=a(53216),c=a(15745);async function l(e){const t=(0,i.C)("calendar","talk_api_version"),a=e.getConferenceList()[0]?.uri??e.location;if(!a||!a.startsWith(window.location.protocol+"//"+window.location.host))return void o.Ay.debug("Event's conference/location is from another host",a);const l=(d=a,d.match(/\/call\/([a-z0-9]*)(\/|#.*)?$/)?.[1]??void 0);var d;if(l)try{const{data:{ocs:{data:a}}}=await n.Ay.get((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+l),i=await n.Ay.get((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+l+"/participants");if(!i.data.ocs.data.some((e=>e.actorId===(0,s.HW)().uid&&e.participantType<=2)))return void o.Ay.debug("Current user is not a moderator or owner",{currentUser:(0,s.HW)().uid,conversation:i.data.ocs.data});console.info("room",a);for(const i of e.getAttendeeIterator()){if(o.Ay.debug("Processing attendee",{attendee:i}),["GROUP","RESOURCE","ROOM"].includes(i.userType))continue;const e=(0,c.nO)(i.email);try{const i=await n.Ay.get((0,r.KT)("core/autocomplete/",2)+"get?search="+encodeURIComponent(e)+"&itemType=&itemId=%20&shareTypes[]=0&limit=2");1===i.data.ocs.data.length&&i.data.ocs.data[0].id!==(0,s.HW)().uid?await n.Ay.post((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+l+"/participants",{newParticipant:i.data.ocs.data[0].id,source:"users"}):i.data.ocs.data[0]?.id===(0,s.HW)().uid?o.Ay.debug("Skipping organizer "+i.data.ocs.data[0].id):3===a.type?await n.Ay.post((0,r.KT)("apps/spreed/api/"+t+"/",2)+"room/"+l+"/participants",{newParticipant:e,source:"emails"}):o.Ay.debug("Attendee "+e+" ignored as Talk participant")}catch(t){o.Ay.info("Could not add attendee "+e+" as Talk participant",{error:t})}}}catch(e){o.Ay.warn("Could not update Talk room attendees",{error:e})}else o.Ay.debug("URL "+a+" contains no call token")}},15745:(e,t,a)=>{function n(e){return"string"!=typeof e?"":e.startsWith("mailto:")?e.slice(7):e}a.d(t,{nO:()=>n})},67982:(e,t,a)=>{a.d(t,{s:()=>r});var n=a(88075);const r=(e,t)=>{const a=e.calendarComponent.getVObjectIterator().next().value;if(!a)return null;const r=n.Z4.fromJSDate(t,!0);return a.recurrenceManager.getOccurrenceAtExactly(r)}},88484:(e,t,a)=>{a.d(t,{GM:()=>c,dU:()=>d,mj:()=>u,nJ:()=>l});var n=a(10734),r=a.n(n),i=a(41769),s=a(9048),o=a(39661);function c(e){const t=(0,i.V)(e);return"#"+r().rgb.hex(t.r,t.g,t.b)}function l(e){return/^(#)((?:[A-Fa-f0-9]{3}){1,2})$/.test(e)?e:/^((?:[A-Fa-f0-9]{3}){1,2})$/.test(e)?"#"+e:/^(#)((?:[A-Fa-f0-9]{8}))$/.test(e)?e.slice(0,7):!!/^((?:[A-Fa-f0-9]{8}))$/.test(e)&&"#"+e.slice(0,6)}function d(e){return s[e]||null}function u(e){return(0,o.A)(e)}},77555:(e,t,a)=>{a.d(t,{PY:()=>r,RK:()=>n,z8:()=>i});a(53216);function n(){return new Date}function r(e){return Math.floor(e.getTime()/1e3)}function i(e){return new Date(e.year,e.month-1,e.day,e.hour,e.minute,0,0)}},53216:(e,t,a)=>{a.d(t,{Ay:()=>i,fH:()=>r});const n=(0,a(35947).YK)().setApp("calendar").detectUser().build(),r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.info(e,t)},i=n},87856:(e,a,n)=>{n.d(a,{default:()=>y});var r=n(51849),i=n(40819),s=n(38679),o=n(58196),c=n(83843),l=n(28928),d=n(62863),u=n(44823),p=n(88075);const m={name:"ContactsMenuAvailability",components:{FreeBusy:u.A},props:{userId:{type:String,required:!0},userDisplayName:{type:String,required:!0},userEmail:{type:String,required:!0}},data(){const e=p.Uy.fromNameAndEMail(this.userDisplayName,this.userEmail);return{initialized:!1,attendees:[(0,o.Wj)(e)]}},computed:{...(0,r.n2)(i.A,s.A),dialogName(){return t("calendar","Availability of {displayName}",{displayName:this.userDisplayName})},startDate:()=>new Date,endDate(){const e=new Date(this.startDate);return e.setHours(e.getHours()+1),e},organizer(){if(!this.principalsStore.getCurrentUserPrincipal)throw new Error("No principal available for current user");return(0,o.Ay)(this.principalsStore.getCurrentUserPrincipal,!0)}},async created(){this.initSettings(),await(0,l.Db)(),await this.principalsStore.fetchCurrentUserPrincipal(),(0,d.A)(),await this.loadMomentLocale(),this.initialized=!0},methods:{initSettings(){this.settingsStore.loadSettingsFromServer({timezone:"automatic"}),this.settingsStore.initializeCalendarJsConfig()},async loadMomentLocale(){const e=await(0,c.A)();this.settingsStore.setMomentLocale({locale:e})},addAttendee(e){let{commonName:t,email:a}=e;this.attendees.push((0,o.Wj)(p.Uy.fromNameAndEMail(t,a)))},removeAttendee(e){let{email:t}=e;this.attendees=this.attendees.filter((e=>e.uri!==t))},close(){this.$destroy()}}};const y=(0,n(14486).A)(m,(function(){var e=this,t=e._self._c;return e.initialized?t("FreeBusy",{attrs:{"dialog-name":e.dialogName,"start-date":e.startDate,"end-date":e.endDate,organizer:e.organizer,attendees:e.attendees,"disable-find-time":!0},on:{"add-attendee":e.addAttendee,"remove-attendee":e.removeAttendee,close:e.close}}):e._e()}),[],!1,null,"74d28dd0",null).exports}}]);
//# sourceMappingURL=calendar-src_services_talkService_js-src_utils_calendarObject_js-src_utils_color_js-src_utils_date_js--af18c6.js.map?v=bb1229f4c8f95a2b0615